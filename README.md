# UR5 Controller for OpenRAVE

![Plugin Demo](repo_assets/demo.gif "Plugin Demo")

This controller will listen to ROS topic that publishes the joint values of the UR5 robot in real time and will visualise the current state of a UR5 robot in OpenRAVE.

Another important functionality of this plugin is that is able to execute trajectories generated by OpenRAVE planners on the real robot.

There is a test program that demonstrates this functionality under [`scripts/control_ur5`](scripts/control_ur5.py) in which case will load UR5 in OpenRAVE and then let you control the UR5 robot above a table (move left, right, forward, backwards and rotate the gripper clockwise and anti-clockwise).

## Includes
This repository includes the following:
- The custom written controller for OpenRAVE and UR5 robot.
- The URDF and SRDF files for UR5 itself, Robotiq Two-Finger Gripper, and Clearpath Ridgeback moving base.

## Dependencies
- [ur_modern_driver](https://github.com/ThomasTimm/ur_modern_driver) needs to be installed on the computer that controls the robot and you need to run `roslaunch ur_modern_driver ur5_bringup.launch robot_ip:=THE_IP_OF_UR5_ROBOT`.
- [openrave_catkin](https://github.com/personalrobotics/openrave_catkin).
- You need to install and configure another OpenRAVE plugin called `or_urdf` this plugin is available [here](https://github.com/personalrobotics/or_urdf). I have written a blog post on 
how to install this plugin if you struggle to find a solution, find the tutorial [here](http://computingstories.com/robotics%20stories/installing-or_urdf-openrave-plugin.html).

## Installation
- Go to your catkin worksapce e.g `cd ~/catkin_ws/src` and clone this repository: `git clone git@github.com:papallas/ur5controller.git`
- Add the following line in your `~/.bashrc` file located under your home directory by running the following command in the terminal: `echo 'export TODO' >> ~/.bashrc`
- Run `source ~/.bashrc`.
- Go to your catkin workspace `cd ~/catkin_ws` and run `catkin_make`. You should see a successful message on build in which case you are ready to go. If you get any errors at this stage, please review what went wrong.

## Testing the controller
There is a file called `control_ur5.py` under `scripts` that you can run and test the controller on the real robot.

## Other Notes
- This repository ships with an URDF and SRDF file that represents the robot in OpenRAVE. These however includes two specific things that might not be applicable to your configuration, the Robotiq Two-Finger Gripper and the Clearpath Ridgeback. If you are not interested in those, you can remove them easily by editting the `.URDF` file.
   - Removing the Clearpath Ridgeback base: Open the `URDF` file and delete all the lines about the Ridgeback (the lines between the Ridgeback and the UR5 are separated by comments). You don't need to do anything else.
   - Removing the Robotiq Two-Finger Gripper however, requires some extra effort. You need to delete the lines about the gripper from the `URDF` file, and you also need to edit the `.SRDF` file and make the following changes:
   ```
       <group name="manipulator">
           <chain base_link="base_link" tip_link="ee_link" />
       </group>
   ```

   And delete the following lines:
   ```
       <group name="endeffector">
           <link name="ee_link" />
       </group>
       .
       .
       <end_effector name="hand" parent_link="ee_link" group="endeffector" parent_group='manipulator' />
   ```
   
## Contributors
UR5 OpenRAVE controller was developed by the Robotics Lab in the School of Computing at the University of Leeds. This software is developed and maintained by [Rafael Papallas](https://github.com/papallas).
